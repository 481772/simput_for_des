<!DOCTYPE html>
<html lang="en">
<head prefix="og: http://ogp.me/ns#">
  <meta charset="utf-8">
  <title>Create simulation inputs with Simput | SimPut</title>
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- Canonical links -->
  <link rel="canonical" href="https://kitware.github.io/simput/docs/oscillator.html">
  <!-- Alternative links -->
  
    
      <link rel="alternative" hreflang="en" href="https://kitware.github.io/simput/docs/oscillator.html">
    
  
  <!-- Icon -->
  <link rel="apple-touch-icon" sizes="57x57" href="/simput/icon/apple-touch-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/simput/icon/apple-touch-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/simput/icon/apple-touch-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/simput/icon/apple-touch-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/simput/icon/apple-touch-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/simput/icon/apple-touch-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/simput/icon/apple-touch-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/simput/icon/apple-touch-icon-152x152.png">
  <link rel="icon" type="image/png" href="/simput/icon/favicon-196x196.png" sizes="196x196">
  <link rel="icon" type="image/png" href="/simput/icon/favicon-160x160.png" sizes="160x160">
  <link rel="icon" type="image/png" href="/simput/icon/favicon-96x96.png" sizes="96x96">
  <link rel="icon" type="image/png" href="/simput/icon/favicon-16x16.png" sizes="16x16">
  <link rel="icon" type="image/png" href="/simput/icon/favicon-32x32.png" sizes="32x32">
  <meta name="msapplication-TileColor" content="#2f83cd">
  <meta name="msapplication-TileImage" content="/simput/icon/mstile-144x144.png">
  <!-- CSS -->
  <!-- build:css build/css/navy.css -->
  <link rel="stylesheet" href="/simput/css/navy.css">
  <!-- endbuild -->
  <link href="https://fonts.googleapis.com/css?family=Lato:300,400,700" rel="stylesheet" type="text/css">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.css">
  <!-- RSS -->
  <link rel="alternate" href="/simput/atom.xml" title="SimPut">
  <!-- Open Graph -->
  <meta name="description" content="center.half &amp;gt; img {   width: 50%; }   This example is more complete and complex than the simple vcard example. It includes three output files and the different views to support them. We will walk you">
<meta property="og:type" content="website">
<meta property="og:title" content="Create simulation inputs with Simput">
<meta property="og:url" content="https://kitware.github.io/simput/docs/oscillator.html">
<meta property="og:site_name" content="SimPut">
<meta property="og:description" content="center.half &amp;gt; img {   width: 50%; }   This example is more complete and complex than the simple vcard example. It includes three output files and the different views to support them. We will walk you">
<meta property="og:locale" content="en">
<meta property="og:image" content="https://kitware.github.io/simput/docs/oscillator-step-0.png">
<meta property="og:image" content="https://kitware.github.io/simput/docs/oscillator-step-1.png">
<meta property="og:image" content="https://kitware.github.io/simput/docs/oscillator-step-2.png">
<meta property="og:image" content="https://kitware.github.io/simput/docs/oscillator-step-3.png">
<meta property="og:image" content="https://kitware.github.io/simput/docs/oscillator-step-4.png">
<meta property="og:updated_time" content="2018-10-16T20:59:21.645Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Create simulation inputs with Simput">
<meta name="twitter:description" content="center.half &amp;gt; img {   width: 50%; }   This example is more complete and complex than the simple vcard example. It includes three output files and the different views to support them. We will walk you">
<meta name="twitter:image" content="https://kitware.github.io/simput/docs/oscillator-step-0.png">
  <!-- Google Analytics -->
  
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-90338862-11', 'auto');
  ga('send', 'pageview');
</script>

</head>

<body>
  <div id="container">
    <header id="header" class="wrapper">
  <div id="header-inner" class="inner">
    <h1 id="logo-wrap">
      <a href="/simput/" id="logo">SimPut</a>
    </h1>
    <nav id="main-nav">
      <a href="/simput/docs/" class="main-nav-link">Docs</a><a href="/simput/app/" class="main-nav-link">Application</a>
      <a href="https://github.com/kitware/simput" class="main-nav-link"><i class="fa fa-github-alt"></i></a>
      <div id="search-input-wrap">
        <div id="search-input-icon">
          <i class="fa fa-search"></i>
        </div>
        <input type="search" id="search-input" placeholder="Search...">
      </div>
    </nav>
    <a id="mobile-nav-toggle">
      <span class="mobile-nav-toggle-bar"></span>
      <span class="mobile-nav-toggle-bar"></span>
      <span class="mobile-nav-toggle-bar"></span>
    </a>
  </div>
</header>

    <div id="content-wrap">
  <div id="content" class="wrapper">
    <div id="content-inner">
      <article class="article-container" itemscope itemtype="http://schema.org/Article">
        <div class="article-inner">
          <div class="article">
            <div class="inner">
              <header class="article-header">
                <h1 class="article-title" itemprop="name">Create simulation inputs with Simput</h1>
              </header>
              <div class="article-content" itemprop="articleBody">
                <style>
center.half > img {
  width: 50%;
}
</style>

<p>This example is more complete and complex than the simple <a href="vcard.html">vcard example</a>. It includes three output files and the different views to support them. We will walk you through the model definition and its usage inside Simput.</p>
<h2 id="What’s-an-Oscillator" class="article-heading"><a href="#What’s-an-Oscillator" class="headerlink" title="What’s an Oscillator?"></a>What’s an Oscillator?<a class="article-anchor" href="#What’s-an-Oscillator" aria-hidden="true"></a></h2><p>We are going to create input files for the <a href="https://gitlab.kitware.com/sensei/sensei/tree/master/miniapps/oscillators" target="_blank" rel="noopener">oscillators miniapp</a>, which is part of the <a href="https://gitlab.kitware.com/sensei/sensei" target="_blank" rel="noopener">Sensei project</a>. It is designed to emulate the output of a simulation, without actually doing the complicated calculations typical of a simulation. It is used to test the performance of in-situ analysis code, which takes the raw output of a simulation and either visualizes it or performs analysis on it to summarize or compress the results.</p>
<p>The oscillator app takes as input a list of gaussian oscillators with a few parameters that tell their position, size, and how they vary over time. The contents of an input file might look like this:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># type      center      r       omega0      zeta</span><br><span class="line">damped      32 32 32    12.5    3.14        0.3</span><br><span class="line">damped      48 32 48    5       3.14        0.1</span><br><span class="line">decaying    16 32 48    15      3.14</span><br><span class="line">periodic    16 32 16    10      9.5</span><br><span class="line">periodic    48 32 16    15      3.14</span><br></pre></td></tr></table></figure>
<p>We will also create two other input files. The first is an xml specification of a list of analyses to perform on the simulation output. The second is a script file to run the oscillator in a multi-process context with the other two input files. We’ll get back to those other files later on.</p>
<h2 id="Creation-of-the-new-type" class="article-heading"><a href="#Creation-of-the-new-type" class="headerlink" title="Creation of the new type"></a>Creation of the new type<a class="article-anchor" href="#Creation-of-the-new-type" aria-hidden="true"></a></h2><h3 id="Setup" class="article-heading"><a href="#Setup" class="headerlink" title="Setup"></a>Setup<a class="article-anchor" href="#Setup" aria-hidden="true"></a></h3><p>First we need to create a directory for our files. After <a href="develop_requirement.html">cloning simput</a> and running <code>npm install</code>, create the directories <code>types/oscillator/src</code>, and the file <code>types/oscillator/README.md</code> to document our type.</p>
<p>Next we add a line to <code>package.json</code> to compile our type:<br><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="string">"scripts"</span>: &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  <span class="string">"type:oscillator"</span>: <span class="string">"node ./src/cli/simput-cli.js -c ./types/oscillator/src -o ./static/types -t oscillator"</span>,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>Finally we add our type to the landing page. In <code>static/index.html</code>:<br><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Register various template</span></span><br><span class="line">Simput.registerType(<span class="string">'demo'</span>, [<span class="string">'./types/demo.js'</span>]);</span><br><span class="line"><span class="comment">// add to list:</span></span><br><span class="line">Simput.registerType(<span class="string">'oscillator'</span>, [<span class="string">'./types/oscillator.js'</span>]);</span><br></pre></td></tr></table></figure></p>
<p>and in <code>src/samples/index.js</code>:<br><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  label: <span class="string">'Oscillator'</span>,</span><br><span class="line">  image: Images.oscillator,</span><br><span class="line">  <span class="comment">// icon: 'wb_sunny', // or start with an icon</span></span><br><span class="line">  description: <span class="string">'Oscillator source for In-Situ simulation'</span>,</span><br><span class="line">  acknowledgement: <span class="string">'Example by Kitware Inc.'</span>,</span><br><span class="line">  model: &#123;</span><br><span class="line">    type: <span class="string">'oscillator'</span>,</span><br><span class="line">    data: &#123;&#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure></p>
<p>We added an image in the <code>images</code> subdirectory, but an icon from <code>vuetify</code> can be used instead.</p>
<h3 id="Model-creation" class="article-heading"><a href="#Model-creation" class="headerlink" title="Model creation"></a>Model creation<a class="article-anchor" href="#Model-creation" aria-hidden="true"></a></h3><p>Let’s create a View to contain our list of gaussian oscillators. The is specified as a json or javascript object, though we recommend javascript because it can contain comments. Our <strong>data model</strong> needs an entry for each of the gaussian’s parameters, and the variable-sized list to contain them. Create the file <code>types/oscillator/src/model.js</code>:</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// model.js</span></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  order: [<span class="string">'oscillators'</span>],</span><br><span class="line">  views: &#123;</span><br><span class="line">    oscillators: &#123;</span><br><span class="line">      size: <span class="number">-1</span>,</span><br><span class="line">      attributes: [<span class="string">'oscillator'</span>],</span><br><span class="line">      hooks: [</span><br><span class="line">        &#123;</span><br><span class="line">          type: <span class="string">'copyParameterToViewName'</span>,</span><br><span class="line">          attribute: <span class="string">'oscillator.name'</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">      ],</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">  definitions: &#123;</span><br><span class="line">    oscillator: &#123;</span><br><span class="line">      parameters: [</span><br><span class="line">        &#123;</span><br><span class="line">          id: <span class="string">'name'</span>,</span><br><span class="line">          label: <span class="string">'Name'</span>,</span><br><span class="line">          type: <span class="string">'string'</span>,</span><br><span class="line">          size: <span class="number">1</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          id: <span class="string">'type'</span>,</span><br><span class="line">          type: <span class="string">'enum'</span>,</span><br><span class="line">          size: <span class="number">1</span>,</span><br><span class="line">          <span class="keyword">default</span>: <span class="string">'periodic'</span>,</span><br><span class="line">          domain: &#123;</span><br><span class="line">            Periodic: <span class="string">'periodic'</span>,</span><br><span class="line">            Decaying: <span class="string">'decaying'</span>,</span><br><span class="line">            Damped: <span class="string">'damped'</span>,</span><br><span class="line">          &#125;,</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          id: <span class="string">'center'</span>,</span><br><span class="line">          type: <span class="string">'int'</span>,</span><br><span class="line">          size: <span class="number">3</span>,</span><br><span class="line">          layout: <span class="string">'3'</span>,</span><br><span class="line">          <span class="keyword">default</span>: [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>],</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          id: <span class="string">'radius'</span>,</span><br><span class="line">          type: <span class="string">'double'</span>,</span><br><span class="line">          size: <span class="number">1</span>,</span><br><span class="line">          <span class="keyword">default</span>: [<span class="number">1</span>],</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          id: <span class="string">'omega0'</span>,</span><br><span class="line">          type: <span class="string">'double'</span>,</span><br><span class="line">          size: <span class="number">1</span>,</span><br><span class="line">          <span class="keyword">default</span>: [<span class="number">1</span>],</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          id: <span class="string">'zeta'</span>,</span><br><span class="line">          type: <span class="string">'double'</span>,</span><br><span class="line">          size: <span class="number">1</span>,</span><br><span class="line">          show: <span class="string">"type[0] === 'damped'"</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">      ],</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>This model definition will be automatically displayed as a form for the user to fill out, with add and delete buttons for changing the list of oscillators.</p>
<p>These parameters illustrate some of the different types and options available. Parameter types can be <code>double</code>, <code>int</code>, <code>string</code>, <code>enum</code>, or <code>bool</code>. Parameters like <code>center</code> with a <code>size</code> greater than 1 can choose different layouts. The <code>zeta</code> parameter doesn’t have a default value, so it is only defined if the user fills it in. It also is only visible depending on the value of the <code>type</code> parameter.</p>
<h3 id="Template-file" class="article-heading"><a href="#Template-file" class="headerlink" title="Template file"></a>Template file<a class="article-anchor" href="#Template-file" aria-hidden="true"></a></h3><p>Template files define our output - the files we produce for input to the simulation. The oscillator list is very simple, with a single line per oscillator. Here, we just loop over lines and output them, using triple-curly-brace to signal a variable substitution. Several kinds of looping and conditionals are available inside a <a href="https://handlebarsjs.com/" target="_blank" rel="noopener">Handlebars template</a>, which we’ll see later.</p>
<figure class="highlight handlebars"><table><tr><td class="code"><pre><span class="line"><span class="comment">&#123;&#123;!-- oscillator_list.hbs --&#125;&#125;</span></span><br><span class="line"><span class="template-tag">&#123;&#123;#<span class="name"><span class="builtin-name">each</span></span> lines&#125;&#125;</span></span><br><span class="line"><span class="template-variable">&#123;&#123;line&#125;&#125;</span></span><br><span class="line"><span class="template-tag">&#123;&#123;/<span class="name"><span class="builtin-name">each</span></span>&#125;&#125;</span></span><br></pre></td></tr></table></figure>
<h3 id="Convert-function" class="article-heading"><a href="#Convert-function" class="headerlink" title="Convert function"></a>Convert function<a class="article-anchor" href="#Convert-function" aria-hidden="true"></a></h3><p>How do we get from our model and the input from the user, to the list of lines needed by our template? This is the job of the convert function. Let’s take a look:</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// convert.js</span></span><br><span class="line"><span class="keyword">const</span> outputTemplate = <span class="built_in">require</span>(<span class="string">'./oscillator_list.hbs'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> COLUMN_SPACING = <span class="number">5</span>;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="keyword">function</span> <span class="title">convert</span>(<span class="params">dataModel</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> results = &#123;&#125;;</span><br><span class="line">  <span class="comment">// Start with a standard header</span></span><br><span class="line">  <span class="keyword">const</span> lines = [[<span class="string">'# type  '</span>, <span class="string">'center  '</span>, <span class="string">'r  '</span>, <span class="string">'omega0  '</span>, <span class="string">'zeta'</span>]];</span><br><span class="line"></span><br><span class="line">  dataModel.data.oscillators.forEach(<span class="function">(<span class="params">attributes</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> oscillator = &#123;&#125;;</span><br><span class="line">    <span class="built_in">Object</span>.keys(attributes.oscillator).forEach(<span class="function">(<span class="params">fieldName</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> value = attributes.oscillator[fieldName].value;</span><br><span class="line">      <span class="keyword">if</span> (value.length === <span class="number">1</span>) &#123;</span><br><span class="line">        oscillator[fieldName] = value[<span class="number">0</span>];</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        oscillator[fieldName] = value;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="built_in">console</span>.log(oscillator);</span><br><span class="line">    lines.push([</span><br><span class="line">      <span class="string">`<span class="subst">$&#123;oscillator.type&#125;</span>`</span>,</span><br><span class="line">      <span class="string">`<span class="subst">$&#123;oscillator.center[<span class="number">0</span>]&#125;</span> <span class="subst">$&#123;oscillator.center[<span class="number">1</span>]&#125;</span> <span class="subst">$&#123;oscillator.center[<span class="number">2</span>]&#125;</span>`</span>,</span><br><span class="line">      <span class="string">`<span class="subst">$&#123;oscillator.radius&#125;</span>`</span>,</span><br><span class="line">      <span class="string">`<span class="subst">$&#123;oscillator.omega0&#125;</span>`</span>,</span><br><span class="line">      <span class="string">`<span class="subst">$&#123;oscillator.zeta || <span class="string">''</span>&#125;</span>`</span>,</span><br><span class="line">    ]);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Compute max size of each column</span></span><br><span class="line">  <span class="keyword">const</span> sizes = [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>];</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> lineIdx = <span class="number">0</span>; lineIdx &lt; lines.length; lineIdx++) &#123;</span><br><span class="line">    <span class="keyword">const</span> line = lines[lineIdx];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> tokenIdx = <span class="number">0</span>; tokenIdx &lt; line.length; tokenIdx++) &#123;</span><br><span class="line">      sizes[tokenIdx] = <span class="built_in">Math</span>.max(sizes[tokenIdx], line[tokenIdx].length);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Add padding to align columns</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> lineIdx = <span class="number">0</span>; lineIdx &lt; lines.length; lineIdx++) &#123;</span><br><span class="line">    <span class="keyword">const</span> line = lines[lineIdx];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> tokenIdx = <span class="number">0</span>; tokenIdx &lt; line.length; tokenIdx++) &#123;</span><br><span class="line">      <span class="keyword">while</span> (line[tokenIdx].length &lt; sizes[tokenIdx] + COLUMN_SPACING) &#123;</span><br><span class="line">        line[tokenIdx] += <span class="string">' '</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// collapse tokens</span></span><br><span class="line">    lines[lineIdx] = &#123; <span class="attr">line</span>: lines[lineIdx].join(<span class="string">''</span>) &#125;;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Use dummy line writer</span></span><br><span class="line">  results[<span class="string">'oscillator_list.osc'</span>] = outputTemplate(&#123; lines &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> &#123; results, <span class="attr">model</span>: dataModel &#125;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>The conversion actually happens in the first loop, where the objects from the data model have their <code>value</code> fields extracted and put into a list in the correct order. Two more loops calculate lengths and add padding to make columns line up nicely. Finally, this statement: <code>lines[lineIdx] = { line: lines[lineIdx].join(&#39;&#39;) };</code> converts to a list of objects with the key <code>line</code>, which is used in the template as <code></code>.</p>
<p>Note that the <code>name</code> parameter is not actually used in the template and output. It is provided as a convenience to the user, so they can distinguish the different oscillators if they choose to.</p>
<h2 id="Compilation-of-new-type" class="article-heading"><a href="#Compilation-of-new-type" class="headerlink" title="Compilation of new type"></a>Compilation of new type<a class="article-anchor" href="#Compilation-of-new-type" aria-hidden="true"></a></h2><p>If you clone the repository and ran <code>npm install</code> during setup, you should be able to run:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ npm run type:oscillator</span><br></pre></td></tr></table></figure>
<p>to compile the new type, and in a separate window</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ npm run dev</span><br></pre></td></tr></table></figure>
<p>to compile Simput and start a development server.</p>
<h2 id="Fill-in-your-data" class="article-heading"><a href="#Fill-in-your-data" class="headerlink" title="Fill in your data"></a>Fill in your data<a class="article-anchor" href="#Fill-in-your-data" aria-hidden="true"></a></h2><p>Open <a href="http://localhost:9999" target="_blank" rel="noopener">http://localhost:9999</a> in your browser.</p>
<center class="half"><br><img src="oscillator-step-0.png" alt=""><br>Landing page<br></center>

<p>Click the <code>oscillator</code> card.</p>
<center class="half"><br><img src="oscillator-step-1.png" alt=""><br>Initial empty page / content<br></center>

<p>Click the <code>+</code> button to add some oscillators, and start filling them in…</p>
<center class="half"><br><img src="oscillator-step-2.png" alt=""><br>Add some oscillators<br></center>

<p>Then press the <code>Save</code> button.</p>
<p>A zip file is written, which contains <code>oscillator_list.osc</code> along with the data model.</p>
<p>If you restart Simput and drag-and-drop this zip file onto the <code>Open an existing model</code> box, you will find all the information you’ve entered.</p>
<h2 id="Note-about-labels" class="article-heading"><a href="#Note-about-labels" class="headerlink" title="Note about labels"></a>Note about labels<a class="article-anchor" href="#Note-about-labels" aria-hidden="true"></a></h2><p>We didn’t include any <code>label</code> tags in our model definition, yet our screenshots show understandable labels and even help text. These are defined in the <code>lang/en</code> subdirectory, and can be translated into additional languages as needed. There is a straightforward mapping between the model definition and the <code>label.json</code> structure and help files that provide the UI text. <a href="https://github.com/Kitware/simput/tree/master/types/oscillator/src/lang/en" target="_blank" rel="noopener">Take a look</a>.</p>
<h2 id="More-output-files" class="article-heading"><a href="#More-output-files" class="headerlink" title="More output files"></a>More output files<a class="article-anchor" href="#More-output-files" aria-hidden="true"></a></h2><p>The oscillator requires two other files to run - an <code>xml</code> file that specifies which analyses to run, and a script that constructs the right command line to run in a multi-process environment using OpenMPI. Let’s take a look at <code>ananlysis_config.xml</code> and <code>run_script.sh</code></p>
<h3 id="Another-template-and-model-definition" class="article-heading"><a href="#Another-template-and-model-definition" class="headerlink" title="Another template and model definition"></a>Another template and model definition<a class="article-anchor" href="#Another-template-and-model-definition" aria-hidden="true"></a></h3><p>Here’s the template for <code>analysis_config.xml</code>:</p>
<figure class="highlight handlebars"><table><tr><td class="code"><pre><span class="line"><span class="comment">&#123;&#123;!-- analysis_config.hbs --&#125;&#125;</span></span><br><span class="line">&lt;sensei&gt;</span><br><span class="line"><span class="template-tag">&#123;&#123;#<span class="name"><span class="builtin-name">each</span></span> histogram&#125;&#125;</span></span><br><span class="line">  &lt;analysis type="histogram" mesh="<span class="template-variable">&#123;&#123;mesh&#125;&#125;</span>" array="<span class="template-variable">&#123;&#123;array&#125;&#125;</span>" association="<span class="template-variable">&#123;&#123;association&#125;&#125;</span>"</span><br><span class="line">    bins="<span class="template-variable">&#123;&#123;bins&#125;&#125;</span>" enabled="1" /&gt;</span><br><span class="line"><span class="template-tag">&#123;&#123;/<span class="name"><span class="builtin-name">each</span></span>&#125;&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="template-tag">&#123;&#123;#<span class="name"><span class="builtin-name">each</span></span> autocorrelation&#125;&#125;</span></span><br><span class="line">  &lt;analysis type="autocorrelation" mesh="<span class="template-variable">&#123;&#123;mesh&#125;&#125;</span>" array="data" association="cell"</span><br><span class="line">    window="<span class="template-variable">&#123;&#123;window&#125;&#125;</span>" k-max="<span class="template-variable">&#123;&#123;kmax&#125;&#125;</span>" enabled="1" /&gt;</span><br><span class="line"><span class="template-tag">&#123;&#123;/<span class="name"><span class="builtin-name">each</span></span>&#125;&#125;</span></span><br><span class="line"></span><br><span class="line">&lt;/sensei&gt;</span><br></pre></td></tr></table></figure>
<p>There are two types of analysis, histogram and autocorrelation. They have similar, but not identical parameters. The use of the <code>{{#each histogram}}</code> construct lets us pass a list to the template, and output zero or more blocks, depending on how many objects are in the list. The <code>run_script.sh</code> template is very simple, <a href="https://github.com/Kitware/simput/blob/master/types/oscillator/src/run_script.hbs" target="_blank" rel="noopener">take a look here</a>.</p>
<p>We need to add views to our data model for each of these files, like this:</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  order: [<span class="string">'oscillators'</span>, <span class="string">'analyses'</span>, <span class="string">'run'</span>],</span><br><span class="line">  views: &#123;</span><br><span class="line">    oscillators: &#123; ... &#125;</span><br><span class="line">    analyses: &#123;</span><br><span class="line">      size: <span class="number">-1</span>,</span><br><span class="line">      attributes: [<span class="string">'analysis'</span>],</span><br><span class="line">      hooks: [</span><br><span class="line">        &#123;</span><br><span class="line">          type: <span class="string">'copyParameterToViewName'</span>,</span><br><span class="line">          attribute: <span class="string">'analysis.name'</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">      ],</span><br><span class="line">    &#125;,</span><br><span class="line">    run: &#123;</span><br><span class="line">      attributes: [<span class="string">'runParams'</span>],</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">  definitions: &#123;</span><br><span class="line">    oscillator: &#123; ... &#125;,</span><br><span class="line">    analysis: &#123;</span><br><span class="line">      parameters: [</span><br><span class="line">        &#123;</span><br><span class="line">          id: <span class="string">'name'</span>,</span><br><span class="line">          label: <span class="string">'Name'</span>,</span><br><span class="line">          type: <span class="string">'string'</span>,</span><br><span class="line">          size: <span class="number">1</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          id: <span class="string">'type'</span>,</span><br><span class="line">          type: <span class="string">'enum'</span>,</span><br><span class="line">          size: <span class="number">1</span>,</span><br><span class="line">          <span class="keyword">default</span>: <span class="string">'histogram'</span>,</span><br><span class="line">          domain: &#123;</span><br><span class="line">            Histogram: <span class="string">'histogram'</span>,</span><br><span class="line">            Autocorrelation: <span class="string">'autocorrelation'</span>,</span><br><span class="line">          &#125;,</span><br><span class="line">        &#125;,</span><br><span class="line">        [<span class="string">"histogram"</span>, <span class="string">"autocorrelation"</span>],</span><br><span class="line">      ],</span><br><span class="line">      children: &#123;</span><br><span class="line">        histogram: <span class="string">"analysis.type[0] === 'histogram'"</span>,</span><br><span class="line">        autocorrelation: <span class="string">"analysis.type[0] === 'autocorrelation'"</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">    histogram: &#123;</span><br><span class="line">       parameters: [</span><br><span class="line">          &#123;</span><br><span class="line">              id: <span class="string">'mesh'</span>,</span><br><span class="line">              type: <span class="string">'enum'</span>,</span><br><span class="line">              size: <span class="number">1</span>,</span><br><span class="line">              <span class="keyword">default</span>: <span class="string">'mesh'</span>,</span><br><span class="line">              domain: &#123;</span><br><span class="line">                Mesh: <span class="string">'mesh'</span>,</span><br><span class="line">                <span class="string">'Unstructured mesh'</span>: <span class="string">'ucdmesh'</span>,</span><br><span class="line">                <span class="string">'Particle velocity magnitude'</span>: <span class="string">'particles'</span>,</span><br><span class="line">              &#125;,</span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            id: <span class="string">'bins'</span>,</span><br><span class="line">            type: <span class="string">'int'</span>,</span><br><span class="line">            size: <span class="number">1</span>,</span><br><span class="line">            <span class="keyword">default</span>: [<span class="number">10</span>],</span><br><span class="line">          &#125;,</span><br><span class="line">       ],</span><br><span class="line">    &#125;,</span><br><span class="line">    autocorrelation: &#123;</span><br><span class="line">       parameters: [</span><br><span class="line">          &#123;</span><br><span class="line">              id: <span class="string">'mesh'</span>,</span><br><span class="line">              type: <span class="string">'enum'</span>,</span><br><span class="line">              size: <span class="number">1</span>,</span><br><span class="line">              <span class="keyword">default</span>: <span class="string">'mesh'</span>,</span><br><span class="line">              domain: &#123;</span><br><span class="line">                <span class="comment">// currently only works on one type.</span></span><br><span class="line">                Mesh: <span class="string">'mesh'</span>,</span><br><span class="line">              &#125;,</span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            id: <span class="string">'window'</span>,</span><br><span class="line">            type: <span class="string">'double'</span>,</span><br><span class="line">            size: <span class="number">1</span>,</span><br><span class="line">            <span class="keyword">default</span>: [<span class="number">10</span>],</span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            id: <span class="string">'kmax'</span>,</span><br><span class="line">            type: <span class="string">'double'</span>,</span><br><span class="line">            size: <span class="number">1</span>,</span><br><span class="line">            <span class="keyword">default</span>: [<span class="number">3</span>],</span><br><span class="line">          &#125;,</span><br><span class="line">       ],</span><br><span class="line">    &#125;,</span><br><span class="line">    runParams: &#123;</span><br><span class="line">      parameters: [</span><br><span class="line">        &#123;</span><br><span class="line">          id: <span class="string">'nodes'</span>,</span><br><span class="line">          type: <span class="string">'int'</span>,</span><br><span class="line">          size: <span class="number">1</span>,</span><br><span class="line">          <span class="keyword">default</span>: [<span class="number">1</span>],</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          id: <span class="string">'gridsize'</span>,</span><br><span class="line">          type: <span class="string">'int'</span>,</span><br><span class="line">          size: <span class="number">1</span>,</span><br><span class="line">          <span class="keyword">default</span>: [<span class="number">64</span>],</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          id: <span class="string">'dt'</span>,</span><br><span class="line">          type: <span class="string">'double'</span>,</span><br><span class="line">          size: <span class="number">1</span>,</span><br><span class="line">          <span class="keyword">default</span>: [<span class="number">0.1</span>],</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          id: <span class="string">'endT'</span>,</span><br><span class="line">          type: <span class="string">'double'</span>,</span><br><span class="line">          size: <span class="number">1</span>,</span><br><span class="line">          <span class="keyword">default</span>: [<span class="number">10</span>],</span><br><span class="line">        &#125;,</span><br><span class="line">      ],</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>The <code>oscillator</code> sections remain the same, but we add the new views to the <code>order</code> list. Note that the <code>analyses</code> view has a variable size, just like the list of oscillators, but the <code>run</code> section has only a single entry, since there is only one run script.</p>
<p>The <code>analysis</code> definition shows how to change your interface depnding on a parameter - when the user chooses between <code>Histogram</code> and <code>Autocorrelation</code>, one of the <code>children</code> is made visible based on the value of the <code>analysis.type</code> enum. You can also use <code>children</code> to simply organize blocks of parameters, and re-use them as part of different <code>definition</code> blocks. In the UI, they have their own header.</p>
<h3 id="Expanding-the-convert-method" class="article-heading"><a href="#Expanding-the-convert-method" class="headerlink" title="Expanding the convert method"></a>Expanding the convert method<a class="article-anchor" href="#Expanding-the-convert-method" aria-hidden="true"></a></h3><p>Earlier we saw the convert function looped over the list of oscillators created by the user, and formatted them into lines that are output via the template. Our two new output files follow a <a href="https://github.com/Kitware/simput/blob/master/types/oscillator/src/convert.js" target="_blank" rel="noopener">very similar pattern</a>:</p>
<ul>
<li>get a definition object, <code>histogram</code>, <code>autocorrelation</code> or <code>runParams</code>,</li>
<li>get parameters from the object’s keys,</li>
<li>extract parameter values from the <code>value</code> field,</li>
<li>copy them into an object or list of objects.</li>
</ul>
<p>The only complication is in the <code>analyses</code>, where we have a some <a href="https://github.com/Kitware/simput/blob/master/types/oscillator/src/convert.js#L74-L86" target="_blank" rel="noopener">dependent parameters</a>:</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (type === <span class="string">'histogram'</span>) &#123;</span><br><span class="line">  <span class="comment">// fill in associated fields.</span></span><br><span class="line">  <span class="keyword">if</span> (analysis.mesh === <span class="string">'particles'</span>) &#123;</span><br><span class="line">    analysis.array = <span class="string">"velocityMagnitude"</span>;</span><br><span class="line">    analysis.association=<span class="string">"point"</span>;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    analysis.array = <span class="string">"data"</span>;</span><br><span class="line">    analysis.association=<span class="string">"cell"</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  histogram.push(analysis);</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (type === <span class="string">'autocorrelation'</span>) &#123;</span><br><span class="line">  autocorrelation.push(analysis);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>For the <code>histogram</code> analysis, the <code>array</code> and <code>association</code> can be set based on the <code>mesh</code> parameter, and we don’t have to bother the user with setting those parameters, and possibly getting an inconsistent input file for our simulation.</p>
<h2 id="Interaction-now-in-3D" class="article-heading"><a href="#Interaction-now-in-3D" class="headerlink" title="Interaction, now in 3D!"></a>Interaction, now in 3D!<a class="article-anchor" href="#Interaction-now-in-3D" aria-hidden="true"></a></h2><p>The final piece of the oscillator puzzle is showing the user interactively what their inputs mean. The oscillators are placed in a 3D grid, and their radius varies over time based on the user’s inputs. Next we will use the <a href="https://vuejs.org/" target="_blank" rel="noopener">Vue.js</a> framework and <a href="https://kitware.github.io/vtk-js/index.html">vtk.js</a> to show a 3D interactive representation of the gaussian oscillators and their behavior over time.</p>
<p>To see what we’re going to build in this section, take a look at the <a href="http://kitware.github.io/simput/app/">application landing page</a> - the Oscillator image is captured from this widget. Or try it yourself - create some oscillators in the app, and scroll down to see the <code>3D view</code>:</p>
<center class="half"><br><img src="oscillator-step-3.png" alt=""><br>3D View<br></center>

<p>If you want to jump right in, take a look at the <a href="https://github.com/Kitware/simput/tree/master/types/oscillator/src/widgets" target="_blank" rel="noopener">code for this widget</a>. First, let’s look at how to hook up a custom widget in Simput.</p>
<h3 id="Add-a-definition" class="article-heading"><a href="#Add-a-definition" class="headerlink" title="Add a definition"></a>Add a definition<a class="article-anchor" href="#Add-a-definition" aria-hidden="true"></a></h3><p>A few things get added to <code>model.js</code>:</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  views: &#123;</span><br><span class="line">    oscillators: &#123;</span><br><span class="line">      <span class="comment">// ...</span></span><br><span class="line">      hooks: [</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">        &#123;</span><br><span class="line">          type: <span class="string">'oscillatorsToExternal'</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">      ],</span><br><span class="line">    &#125;,</span><br><span class="line">    analyses: &#123; ... &#125;,</span><br><span class="line">    run: &#123;</span><br><span class="line">      attributes: [<span class="string">'runParams'</span>],</span><br><span class="line">      hooks: [</span><br><span class="line">        &#123;</span><br><span class="line">          type: <span class="string">'copyToExternal'</span>,</span><br><span class="line">          src: <span class="string">'data.run.0.runParams.gridsize.value.0'</span>,</span><br><span class="line">          dst: <span class="string">'viz.gridsize'</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          type: <span class="string">'copyToExternal'</span>,</span><br><span class="line">          src: <span class="string">'data.run.0.runParams.dt.value.0'</span>,</span><br><span class="line">          dst: <span class="string">'viz.timeStep'</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          type: <span class="string">'copyToExternal'</span>,</span><br><span class="line">          src: <span class="string">'data.run.0.runParams.endT.value.0'</span>,</span><br><span class="line">          dst: <span class="string">'viz.endTime'</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">      ],</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">  definitions: &#123;</span><br><span class="line">    oscillator: &#123; <span class="comment">// ...</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    oscillatorView: &#123;</span><br><span class="line">      parameters: [</span><br><span class="line">        &#123;</span><br><span class="line">          id: <span class="string">'viz'</span>,</span><br><span class="line">          propType: <span class="string">'ViewerWidget'</span>,</span><br><span class="line">          size: <span class="number">1</span>,</span><br><span class="line">          <span class="keyword">default</span>: &#123;</span><br><span class="line">            text: <span class="string">''</span>,</span><br><span class="line">          &#125;,</span><br><span class="line">          domain: &#123;</span><br><span class="line">            dynamic: <span class="literal">true</span>,</span><br><span class="line">            external: <span class="string">'viz'</span>,</span><br><span class="line">          &#125;,</span><br><span class="line">          label: <span class="string">'Gaussians'</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">      ],</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>First, we add a new <code>oscillatorView</code> definition, with a new <code>propType: &#39;ViewerWidget&#39;</code>, and an external, dynamic <code>domain</code>. This is how we tell Simput to look for our external widget. The external domain <code>viz</code> is how we pass data to our widget to be displayed. To accomplish this, we add <code>hooks</code> to some of the views - the <code>run</code> view copies the <code>gridsize</code>, <code>dt</code> and <code>endT</code> parameters to keys in the <code>viz</code> object, and the <code>oscillators</code> view calls a special hook that we write in the file <code>hooks.js</code> next to our <code>model.js</code> file:</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// hooks.js</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getExternal</span>(<span class="params">dataModel</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (!dataModel.external) &#123;</span><br><span class="line">    dataModel.external = &#123;&#125;;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (!dataModel.external.viz) &#123;</span><br><span class="line">    dataModel.external.viz = &#123;&#125;;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> dataModel.external;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">pushOscillatorsToExternalHook</span>(<span class="params">hookConfig, dataModel, currentViewData</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> external = getExternal(dataModel);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Fill positions, radii</span></span><br><span class="line">  <span class="keyword">if</span> (dataModel.data.oscillators) &#123;</span><br><span class="line">    <span class="keyword">const</span> oscillators = dataModel.data.oscillators;</span><br><span class="line">    external.viz.oscillators = [];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; oscillators.length; i++) &#123;</span><br><span class="line">      <span class="keyword">if</span> (oscillators[i].oscillator) &#123;</span><br><span class="line">        <span class="keyword">const</span> osc = oscillators[i].oscillator;</span><br><span class="line">        external.viz.oscillators.push(&#123;</span><br><span class="line">          <span class="comment">// default to zero if conversion doesn't work.</span></span><br><span class="line">          center: osc.center.value.map(<span class="function">(<span class="params">v</span>) =&gt;</span> <span class="built_in">Math</span>.round(+v) || <span class="number">0</span>),</span><br><span class="line">          name: osc.name.value[<span class="number">0</span>],</span><br><span class="line">          radius: +osc.radius.value[<span class="number">0</span>] || <span class="number">1</span>,</span><br><span class="line">          type: osc.type.value[<span class="number">0</span>],</span><br><span class="line">          omega0: +osc.omega0.value[<span class="number">0</span>] || <span class="number">1</span>,</span><br><span class="line">          zeta: osc.zeta.value ? (+osc.zeta.value[<span class="number">0</span>] || <span class="number">0</span>) : <span class="number">0</span>,</span><br><span class="line">          id: i,</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="keyword">function</span> <span class="title">initialize</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  Simput.registerHook(<span class="string">'oscillatorsToExternal'</span>, pushOscillatorsToExternalHook);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>This setup results in the method <code>pushOscillatorsToExternalHook</code> being called <em>while the user is entering values</em>. As a result it must be tolerant to incomplete or invalid input - in this case, providing default values when the conversion to a number doesn’t work.</p>
<h3 id="ViewerWidget" class="article-heading"><a href="#ViewerWidget" class="headerlink" title="ViewerWidget"></a>ViewerWidget<a class="article-anchor" href="#ViewerWidget" aria-hidden="true"></a></h3><p>This data is passed to our custom widget, <code>ViewerWidget</code>, which is a Vue.js class. It lives in <a href="https://github.com/Kitware/simput/tree/master/types/oscillator/src/widgets/ViewerWidget" target="_blank" rel="noopener">a subdirectory of widgets</a>. The <code>template.html</code> shows its structure:</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">:class</span>=<span class="string">"$style.container"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">:class</span>=<span class="string">"$style.toolbar"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">:class</span>=<span class="string">"$style.line"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">input</span></span></span><br><span class="line"><span class="tag">        <span class="attr">type</span>=<span class="string">"range"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">min</span>=<span class="string">"0"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">:max</span>=<span class="string">"endTime"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">:step</span>=<span class="string">"timeStep"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">:value</span>=<span class="string">"timeSlider"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">:class</span>=<span class="string">"$style.slider"</span></span></span><br><span class="line"><span class="tag">        @<span class="attr">input</span>=<span class="string">"setSliderTime(Number($event.target.value))"</span></span></span><br><span class="line"><span class="tag">      /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span></span></span><br><span class="line"><span class="tag">        <span class="attr">:class</span>=<span class="string">"$style.resetCamera"</span></span></span><br><span class="line"><span class="tag">        @<span class="attr">click</span>=<span class="string">"resetCamera"</span></span></span><br><span class="line"><span class="tag">      /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span></span></span><br><span class="line"><span class="tag">    <span class="attr">ref</span>=<span class="string">"container"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">:class</span>=<span class="string">"$style.container"</span></span></span><br><span class="line"><span class="tag">  /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>Basically a toolbar with a time slider and a reset button, and a container div. Some properties are marked using vue.js syntax as reactive - or linked to data values that change.</p>
<p>Next, the <code>script.js</code> shows how data values are passes to the template and to our vtk.js viewer, with some boiler-plate code removed here:</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> GaussianVTKViewer <span class="keyword">from</span> <span class="string">'../GaussianVTKViewer'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  name: <span class="string">'ViewerWidget'</span>,</span><br><span class="line">  props: &#123;</span><br><span class="line">    prop: &#123;</span><br><span class="line">      required: <span class="literal">true</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    viewData: &#123;</span><br><span class="line">      required: <span class="literal">true</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">  data() &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      help: <span class="literal">false</span>,</span><br><span class="line">      viewer: GaussianVTKViewer.newInstance(),</span><br><span class="line">      timeSlider: <span class="number">0</span>,</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">  computed: &#123;</span><br><span class="line">    viewerData() &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">Object</span>.assign(</span><br><span class="line">        &#123;</span><br><span class="line">          selected: <span class="keyword">this</span>.viewData.id,</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="keyword">this</span>.prop.ui.domain</span><br><span class="line">      );</span><br><span class="line">    &#125;,</span><br><span class="line">    endTime() &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>.prop.ui.domain.endTime;</span><br><span class="line">    &#125;,</span><br><span class="line">    timeStep() &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>.prop.ui.domain.timeStep;</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">  watch: &#123;</span><br><span class="line">    viewerData(data) &#123;</span><br><span class="line">      <span class="keyword">this</span>.viewer.setData(data);</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">  mounted() &#123;</span><br><span class="line">    <span class="keyword">this</span>.$nextTick(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">this</span>.viewer.setContainer(<span class="keyword">this</span>.$refs.container);</span><br><span class="line">      <span class="keyword">this</span>.viewer.setData(<span class="keyword">this</span>.viewerData);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    setSliderTime(value) &#123;</span><br><span class="line">      <span class="keyword">this</span>.viewer.setTime(value);</span><br><span class="line">      <span class="keyword">this</span>.timeSlider = value;</span><br><span class="line">    &#125;,</span><br><span class="line">    resetCamera() &#123;</span><br><span class="line">      <span class="keyword">this</span>.viewer.resetCamera();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>The <code>external.viz</code> object that was filled in by hooks in our data model in the previous step is now provided to our widget as <code>this.prop.ui.domain</code>. We create our vtk.js <code>GaussianVTKViewer</code> as part of the Vue-standard <code>data()</code> method, and we provide data to <code>GaussianVTKViewer</code> by using <code>watch()</code> and <code>computed.viewerData()</code> to create a data object and call <code>this.viewer.setData(data)</code>. The time values from the slider in our template and the reaction to the reset camera button are also passed to the viewer.</p>
<h3 id="3D-view-at-last" class="article-heading"><a href="#3D-view-at-last" class="headerlink" title="3D view at last"></a>3D view at last<a class="article-anchor" href="#3D-view-at-last" aria-hidden="true"></a></h3><p>Viewing objects in 3D is complex, and <a href="https://github.com/Kitware/simput/blob/master/types/oscillator/src/widgets/GaussianVTKViewer.js" target="_blank" rel="noopener">GaussianVTKViewer.js</a> reflects this, unfortunately for our ‘simple’ tutorial! Please browse through the source, to get an idea of how a <a href="https://kitware.github.io/vtk-js/index.html">vtk.js</a> class can create and show geometry. The spheres are created by <code>createSpherePipeline(osc)</code>, and <code>gaussianVTKViewer(publicAPI, model)</code> sets up the initial rendering window and mouse interaction.</p>
<p>Let’s take a look at how data changes are handled:</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">publicAPI.setData = <span class="function">(<span class="params">data</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// convert to integer.</span></span><br><span class="line">    <span class="keyword">if</span> (data.gridsize) data.gridsize = <span class="built_in">Math</span>.floor(+data.gridsize) || <span class="number">64</span>;</span><br><span class="line">    <span class="keyword">if</span> (model.data !== data) &#123;</span><br><span class="line">      model.data = data;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// update pipelines based on new info.</span></span><br><span class="line">      <span class="keyword">if</span> (model.cubePipeline) &#123;</span><br><span class="line">        <span class="keyword">const</span> src = model.cubePipeline.cubeSource;</span><br><span class="line">        <span class="keyword">if</span> (src.getXLength() !== data.gridsize) &#123;</span><br><span class="line">          src.setXLength(data.gridsize);</span><br><span class="line">          src.setYLength(data.gridsize);</span><br><span class="line">          src.setZLength(data.gridsize);</span><br><span class="line">          src.setCenter(</span><br><span class="line">            data.gridsize / <span class="number">2</span>,</span><br><span class="line">            data.gridsize / <span class="number">2</span>,</span><br><span class="line">            data.gridsize / <span class="number">2</span></span><br><span class="line">          );</span><br><span class="line">          <span class="comment">// console.log('new gridsize', data.gridsize);</span></span><br><span class="line">          publicAPI.resetCamera();</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (data.oscillators) &#123;</span><br><span class="line">        publicAPI.removeAllActors();</span><br><span class="line">        <span class="keyword">if</span> (model.cubePipeline) publicAPI.addActor(model.cubePipeline.actor);</span><br><span class="line">        model.spheres = [];</span><br><span class="line">        data.oscillators.forEach(<span class="function">(<span class="params">osc</span>) =&gt;</span> &#123;</span><br><span class="line">          <span class="keyword">const</span> pipeline = createSpherePipeline(osc);</span><br><span class="line">          model.spheres.push(pipeline);</span><br><span class="line">          publicAPI.addActor(pipeline.actor);</span><br><span class="line">        &#125;);</span><br><span class="line">        publicAPI.setTime(model.time);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      publicAPI.modified();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br></pre></td></tr></table></figure>
<p>Again, this method is called while the user is changing values, so it must be tolerant of invalid input. In this case, it reacts to changes in <code>gridsize</code> by changing the bounding box and resetting the camera. Any changes in the oscillators are handled by rebuilding the list of spheres, and making sure they react to the current time setting from the time slider. The <a href="https://github.com/Kitware/simput/blob/master/types/oscillator/src/widgets/GaussianVTKViewer.js#L254-L287" target="_blank" rel="noopener">publicAPI.setTime()</a> method replicates some calculations from the C++ oscillator application, to set the radius of the spheres.</p>
<p><a href="http://kitware.github.io/simput/app/">Try the time slider!</a> If you set a small value for <code>dt</code>, and click the handle of the time slider, you can hold the left/right arrow keys to sweep through time values and see the oscillators vary their radii over time.</p>
<p><img src="oscillator-step-4.png" alt=""></p>
<p>This vtk.js widget is an example of how external javascript libraries can be embedded in Simput types to enhance the presentation of your user’s input. Other examples might be charts, graphs or other data visualization.</p>
<h2 id="Wrapup" class="article-heading"><a href="#Wrapup" class="headerlink" title="Wrapup"></a>Wrapup<a class="article-anchor" href="#Wrapup" aria-hidden="true"></a></h2><p>You now have all the tools and pieces you need to create a new type for Simput, which will simplify life for your users every time they need to create another simulation input file. Please <a href="https://github.com/Kitware/simput/issues" target="_blank" rel="noopener">let us know</a> of any problems you find or feedback you have about this tutorial or Simput in general, or <a href="https://kitware.github.io/simput/docs/develop_build.html">dive in</a> and contribute to Simput, and everyone will benefit!</p>

              </div>
              <footer class="article-footer">
                <time class="article-footer-updated" datetime="2018-10-16T20:59:21.645Z" itemprop="dateModified">Last updated: 2018-10-16</time>
                <a href="vcard.html" class="article-footer-prev" title="Address book"><i class="fa fa-chevron-left"></i><span>Prev</span></a>
              </footer>
              
            </div>
          </div>
          <aside id="article-toc" role="navigation">
            <div id="article-toc-inner">
              <strong class="sidebar-title">Contents</strong>
              <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#What’s-an-Oscillator"><span class="toc-text">What’s an Oscillator?</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Creation-of-the-new-type"><span class="toc-text">Creation of the new type</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Setup"><span class="toc-text">Setup</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Model-creation"><span class="toc-text">Model creation</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Template-file"><span class="toc-text">Template file</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Convert-function"><span class="toc-text">Convert function</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Compilation-of-new-type"><span class="toc-text">Compilation of new type</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Fill-in-your-data"><span class="toc-text">Fill in your data</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Note-about-labels"><span class="toc-text">Note about labels</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#More-output-files"><span class="toc-text">More output files</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Another-template-and-model-definition"><span class="toc-text">Another template and model definition</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Expanding-the-convert-method"><span class="toc-text">Expanding the convert method</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Interaction-now-in-3D"><span class="toc-text">Interaction, now in 3D!</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Add-a-definition"><span class="toc-text">Add a definition</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ViewerWidget"><span class="toc-text">ViewerWidget</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3D-view-at-last"><span class="toc-text">3D view at last</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Wrapup"><span class="toc-text">Wrapup</span></a></li></ol>
              <a href="#" id="article-toc-top">Back to Top</a>
            </div>
          </aside>
        </div>
      </article>
      <aside id="sidebar" role="navigation">
  <div class="inner"><strong class="sidebar-title">Getting Started</strong><a href="index.html" class="sidebar-link">Overview</a><a href="model.html" class="sidebar-link">DataModel definition</a><a href="convert.html" class="sidebar-link">Convert function</a><strong class="sidebar-title">Example</strong><a href="vcard.html" class="sidebar-link">Address book</a><a href="oscillator.html" class="sidebar-link current">Oscillator</a></div>
</aside>
    </div>
  </div>
</div>

    <footer id="footer" class="wrapper">
  <div class="inner">
    <div id="footer-copyright">
      &copy; 2018 <a href="https://www.kitware.com/" target="_blank">Kitware Inc.</a>
    </div>
    <div id="footer-links">
      <a href="https://github.com/kitware/simput" class="footer-link" target="_blank"><i class="fa fa-github-alt"></i></a>
    </div>
  </div>
</footer>

  </div>
  <div id="mobile-nav-dimmer"></div>
  <nav id="mobile-nav">
  <div id="mobile-nav-inner">
    <ul id="mobile-nav-list">
      <a href="/simput/docs/" class="mobile-nav-link">Docs</a><a href="/simput/app/" class="mobile-nav-link">Application</a>
      <li class="mobile-nav-item">
        <a href="https://github.com/kitware/simput" class="mobile-nav-link" rel="external" target="_blank">GitHub</a>
      </li>
    </ul>
    
      <strong class="mobile-nav-title">Getting Started</strong><a href="index.html" class="mobile-nav-link">Overview</a><a href="model.html" class="mobile-nav-link">DataModel definition</a><a href="convert.html" class="mobile-nav-link">Convert function</a><strong class="mobile-nav-title">Example</strong><a href="vcard.html" class="mobile-nav-link">Address book</a><a href="oscillator.html" class="mobile-nav-link current">Oscillator</a>
    
  </div>
  <div id="mobile-lang-select-wrap">
    <span id="mobile-lang-select-label"><i class="fa fa-globe"></i><span>English</span></span>
    <select id="mobile-lang-select" data-canonical="docs/oscillator.html">
      
        <option value="en" selected>English</option>
      
    </select>
  </div>
</nav>
  <!-- Scripts -->
<!-- build:js build/js/main.js -->
<script src="/simput/js/lang_select.js"></script>
<script src="/simput/js/toc.js"></script>
<script src="/simput/js/mobile_nav.js"></script>
<!-- endbuild -->
<script src="https://cdn.jsdelivr.net/retinajs/1.3.0/retina.min.js" async></script>



</body>
</html>